<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# reference

```go
import "github.com/0chain/blobber/code/go/0chain.net/blobbercore/reference"
```

## Index

- [Constants](<#constants>)
- [func AddShareInfo\(ctx context.Context, shareInfo \*ShareInfo\) error](<#AddShareInfo>)
- [func CountRefs\(ctx context.Context, allocationID string\) \(int64, error\)](<#CountRefs>)
- [func DeleteFileStats\(ctx context.Context, refID int64\) error](<#DeleteFileStats>)
- [func DeleteObject\(ctx context.Context, rootRef \*Ref, allocationID, objPath string, ts common.Timestamp\) error](<#DeleteObject>)
- [func DeleteReference\(ctx context.Context, refID int64, pathHash string\) error](<#DeleteReference>)
- [func DeleteShareInfo\(ctx context.Context, shareInfo \*ShareInfo\) error](<#DeleteShareInfo>)
- [func FileBlockDownloaded\(ctx context.Context, ref \*Ref, blocks int64\)](<#FileBlockDownloaded>)
- [func FileUpdated\(ctx context.Context, refID, newRefID int64\)](<#FileUpdated>)
- [func GetListingFieldsMap\(refEntity interface\{\}, tagName string\) map\[string\]interface\{\}](<#GetListingFieldsMap>)
- [func GetReferenceLookup\(allocationID, path string\) string](<#GetReferenceLookup>)
- [func GetRefs\(ctx context.Context, allocationID, path, offsetPath, \_type string, level, pageLimit int\) \(refs \*\[\]PaginatedRef, totalPages int, newOffsetPath string, err error\)](<#GetRefs>)
- [func GetSubDirsFromPath\(p string\) \[\]string](<#GetSubDirsFromPath>)
- [func GetUpdatedRefs\(ctx context.Context, allocationID, path, offsetPath, \_type, updatedDate, offsetDate string, level, pageLimit int, dateLayOut string\) \(refs \*\[\]PaginatedRef, totalPages int, newOffsetPath string, newOffsetDate common.Timestamp, err error\)](<#GetUpdatedRefs>)
- [func IsRefExist\(ctx context.Context, allocationID, path string\) \(bool, error\)](<#IsRefExist>)
- [func NewDirCreated\(ctx context.Context, refID int64\)](<#NewDirCreated>)
- [func NewFileCreated\(ctx context.Context, refID int64\)](<#NewFileCreated>)
- [func UpdateShareInfo\(ctx context.Context, shareInfo \*ShareInfo\) error](<#UpdateShareInfo>)
- [type FileStats](<#FileStats>)
  - [func GetFileStats\(ctx context.Context, ref \*Ref\) \(\*FileStats, error\)](<#GetFileStats>)
  - [func \(f \*FileStats\) BeforeCreate\(tx \*gorm.DB\) error](<#FileStats.BeforeCreate>)
  - [func \(f \*FileStats\) BeforeSave\(tx \*gorm.DB\) error](<#FileStats.BeforeSave>)
  - [func \(FileStats\) TableName\(\) string](<#FileStats.TableName>)
- [type Hashnode](<#Hashnode>)
  - [func LoadRootHashnode\(ctx context.Context, allocationID string\) \(\*Hashnode, error\)](<#LoadRootHashnode>)
  - [func \(n \*Hashnode\) AddChild\(c \*Hashnode\)](<#Hashnode.AddChild>)
  - [func \(n \*Hashnode\) GetLookupHash\(\) string](<#Hashnode.GetLookupHash>)
  - [func \(Hashnode\) TableName\(\) string](<#Hashnode.TableName>)
- [type ObjectPath](<#ObjectPath>)
  - [func GetObjectPath\(ctx context.Context, allocationID string, blockNum int64\) \(\*ObjectPath, error\)](<#GetObjectPath>)
- [type PaginatedRef](<#PaginatedRef>)
  - [func GetRecentlyCreatedRefs\(ctx context.Context, allocID string, pageLimit, offset, fromDate int\) \(refs \[\]\*PaginatedRef, newOffset int, err error\)](<#GetRecentlyCreatedRefs>)
- [type PlaylistFile](<#PlaylistFile>)
  - [func LoadPlaylist\(ctx context.Context, allocationID, path, since string\) \(\[\]PlaylistFile, error\)](<#LoadPlaylist>)
  - [func LoadPlaylistFile\(ctx context.Context, allocationID, lookupHash string\) \(\*PlaylistFile, error\)](<#LoadPlaylistFile>)
- [type QueryCollector](<#QueryCollector>)
  - [func NewCollector\(changes int\) QueryCollector](<#NewCollector>)
- [type Ref](<#Ref>)
  - [func GetLimitedRefFieldsByLookupHash\(ctx context.Context, allocationID, lookupHash string, selectedFields \[\]string\) \(\*Ref, error\)](<#GetLimitedRefFieldsByLookupHash>)
  - [func GetLimitedRefFieldsByLookupHashWith\(ctx context.Context, allocationID, lookupHash string, selectedFields \[\]string\) \(\*Ref, error\)](<#GetLimitedRefFieldsByLookupHashWith>)
  - [func GetLimitedRefFieldsByPath\(ctx context.Context, allocationID, path string, selectedFields \[\]string\) \(\*Ref, error\)](<#GetLimitedRefFieldsByPath>)
  - [func GetObjectTree\(ctx context.Context, allocationID, path string\) \(\*Ref, error\)](<#GetObjectTree>)
  - [func GetRefWithChildren\(ctx context.Context, parentRef \*Ref, allocationID, path string, offset, pageLimit int\) \(\*Ref, error\)](<#GetRefWithChildren>)
  - [func GetRefWithDirListFields\(ctx context.Context, pathHash string\) \(\*Ref, error\)](<#GetRefWithDirListFields>)
  - [func GetRefWithSortedChildren\(ctx context.Context, allocationID, path string\) \(\*Ref, error\)](<#GetRefWithSortedChildren>)
  - [func GetReference\(ctx context.Context, allocationID, path string\) \(\*Ref, error\)](<#GetReference>)
  - [func GetReferenceByLookupHash\(ctx context.Context, allocationID, pathHash string\) \(\*Ref, error\)](<#GetReferenceByLookupHash>)
  - [func GetReferenceByLookupHashForDownload\(ctx context.Context, allocationID, pathHash string\) \(\*Ref, error\)](<#GetReferenceByLookupHashForDownload>)
  - [func GetReferenceForHashCalculationFromPaths\(ctx context.Context, allocationID string, paths \[\]string\) \(\*Ref, error\)](<#GetReferenceForHashCalculationFromPaths>)
  - [func GetReferencePath\(ctx context.Context, allocationID, path string\) \(\*Ref, error\)](<#GetReferencePath>)
  - [func GetReferencePathFromPaths\(ctx context.Context, allocationID string, paths, objTreePath \[\]string\) \(\*Ref, error\)](<#GetReferencePathFromPaths>)
  - [func GetReferencesByName\(ctx context.Context, allocationID, name string\) \(refs \[\]\*Ref, err error\)](<#GetReferencesByName>)
  - [func GetRefsTypeFromPaths\(ctx context.Context, allocationID string, paths \[\]string\) \(refs \[\]\*Ref, err error\)](<#GetRefsTypeFromPaths>)
  - [func ListingDataToRef\(refMap map\[string\]interface\{\}\) \*Ref](<#ListingDataToRef>)
  - [func Mkdir\(ctx context.Context, allocationID, destpath string\) \(\*Ref, error\)](<#Mkdir>)
  - [func NewDirectoryRef\(\) \*Ref](<#NewDirectoryRef>)
  - [func NewFileRef\(\) \*Ref](<#NewFileRef>)
  - [func \(r \*Ref\) AddChild\(child \*Ref\)](<#Ref.AddChild>)
  - [func \(ref \*Ref\) BeforeCreate\(tx \*gorm.DB\) \(err error\)](<#Ref.BeforeCreate>)
  - [func \(ref \*Ref\) BeforeSave\(tx \*gorm.DB\) \(err error\)](<#Ref.BeforeSave>)
  - [func \(r \*Ref\) CalculateDirHash\(ctx context.Context, saveToDB bool, collector QueryCollector\) \(h string, err error\)](<#Ref.CalculateDirHash>)
  - [func \(fr \*Ref\) CalculateFileHash\(ctx context.Context, saveToDB bool, collector QueryCollector\) \(string, error\)](<#Ref.CalculateFileHash>)
  - [func \(r \*Ref\) CalculateHash\(ctx context.Context, saveToDB bool, collector QueryCollector\) \(string, error\)](<#Ref.CalculateHash>)
  - [func \(fr \*Ref\) GetFileHashData\(\) string](<#Ref.GetFileHashData>)
  - [func \(r \*Ref\) GetFileMetaHashData\(\) string](<#Ref.GetFileMetaHashData>)
  - [func \(r \*Ref\) GetHashData\(\) string](<#Ref.GetHashData>)
  - [func \(r \*Ref\) GetListingData\(ctx context.Context\) map\[string\]interface\{\}](<#Ref.GetListingData>)
  - [func \(rootRef \*Ref\) GetSrcPath\(path string\) \(\*Ref, error\)](<#Ref.GetSrcPath>)
  - [func \(r \*Ref\) RemoveChild\(idx int\)](<#Ref.RemoveChild>)
  - [func \(r \*Ref\) Save\(ctx context.Context\) error](<#Ref.Save>)
  - [func \(r \*Ref\) SaveDirRef\(ctx context.Context, collector QueryCollector\) error](<#Ref.SaveDirRef>)
  - [func \(r \*Ref\) SaveFileRef\(ctx context.Context, collector QueryCollector\) error](<#Ref.SaveFileRef>)
  - [func \(Ref\) TableName\(\) string](<#Ref.TableName>)
  - [func \(r \*Ref\) UpdatePath\(newPath, parentPath string\)](<#Ref.UpdatePath>)
- [type ReferencePath](<#ReferencePath>)
- [type ShareInfo](<#ShareInfo>)
  - [func GetShareInfo\(ctx context.Context, clientID, filePathHash string\) \(\*ShareInfo, error\)](<#GetShareInfo>)
  - [func ListShareInfoClientID\(ctx context.Context, ownerID string, limit common.Pagination\) \(\[\]ShareInfo, error\)](<#ListShareInfoClientID>)
  - [func \(ShareInfo\) TableName\(\) string](<#ShareInfo.TableName>)


## Constants

<a name="FILE"></a>

```go
const (
    FILE      = "f"
    DIRECTORY = "d"

    CHUNK_SIZE = 64 * 1024

    DIR_LIST_TAG  = "dirlist"
    FILE_LIST_TAG = "filelist"
)
```

<a name="TableNameReferenceObjects"></a>

```go
const (
    TableNameReferenceObjects = "reference_objects"
)
```

<a name="AddShareInfo"></a>
## func [AddShareInfo](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/shareinfo.go#L29>)

```go
func AddShareInfo(ctx context.Context, shareInfo *ShareInfo) error
```

add share if it already doesnot exist

<a name="CountRefs"></a>
## func [CountRefs](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/referencepath.go#L416>)

```go
func CountRefs(ctx context.Context, allocationID string) (int64, error)
```



<a name="DeleteFileStats"></a>
## func [DeleteFileStats](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/filestats.go#L99>)

```go
func DeleteFileStats(ctx context.Context, refID int64) error
```



<a name="DeleteObject"></a>
## func [DeleteObject](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/object.go#L11>)

```go
func DeleteObject(ctx context.Context, rootRef *Ref, allocationID, objPath string, ts common.Timestamp) error
```



<a name="DeleteReference"></a>
## func [DeleteReference](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L555>)

```go
func DeleteReference(ctx context.Context, refID int64, pathHash string) error
```



<a name="DeleteShareInfo"></a>
## func [DeleteShareInfo](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/shareinfo.go#L44>)

```go
func DeleteShareInfo(ctx context.Context, shareInfo *ShareInfo) error
```



<a name="FileBlockDownloaded"></a>
## func [FileBlockDownloaded](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/filestats.go#L89>)

```go
func FileBlockDownloaded(ctx context.Context, ref *Ref, blocks int64)
```



<a name="FileUpdated"></a>
## func [FileUpdated](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/filestats.go#L62>)

```go
func FileUpdated(ctx context.Context, refID, newRefID int64)
```



<a name="GetListingFieldsMap"></a>
## func [GetListingFieldsMap](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L644>)

```go
func GetListingFieldsMap(refEntity interface{}, tagName string) map[string]interface{}
```



<a name="GetReferenceLookup"></a>
## func [GetReferenceLookup](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L154>)

```go
func GetReferenceLookup(allocationID, path string) string
```

GetReferenceLookup hash\(allocationID \+ ":" \+ path\)

<a name="GetRefs"></a>
## func [GetRefs](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/referencepath.go#L240>)

```go
func GetRefs(ctx context.Context, allocationID, path, offsetPath, _type string, level, pageLimit int) (refs *[]PaginatedRef, totalPages int, newOffsetPath string, err error)
```

This function retrieves reference\_objects tables rows with pagination. Check for issue https://github.com/0chain/gosdk/issues/117 Might need to consider covering index for efficient search https://blog.crunchydata.com/blog/why-covering-indexes-are-incredibly-helpful To retrieve refs efficiently form pagination index is created in postgresql on path column so it can be used to paginate refs very easily and effectively; Same case for offsetDate.

<a name="GetSubDirsFromPath"></a>
## func [GetSubDirsFromPath](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L329>)

```go
func GetSubDirsFromPath(p string) []string
```



<a name="GetUpdatedRefs"></a>
## func [GetUpdatedRefs](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/referencepath.go#L309-L313>)

```go
func GetUpdatedRefs(ctx context.Context, allocationID, path, offsetPath, _type, updatedDate, offsetDate string, level, pageLimit int, dateLayOut string) (refs *[]PaginatedRef, totalPages int, newOffsetPath string, newOffsetDate common.Timestamp, err error)
```

Retrieves updated refs compared to some update\_at value. Useful to localCache

<a name="IsRefExist"></a>
## func [IsRefExist](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L299>)

```go
func IsRefExist(ctx context.Context, allocationID, path string) (bool, error)
```

IsRefExist checks if ref with given path exists and returns error other than gorm.ErrRecordNotFound

<a name="NewDirCreated"></a>
## func [NewDirCreated](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/filestats.go#L43>)

```go
func NewDirCreated(ctx context.Context, refID int64)
```



<a name="NewFileCreated"></a>
## func [NewFileCreated](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/filestats.go#L54>)

```go
func NewFileCreated(ctx context.Context, refID int64)
```



<a name="UpdateShareInfo"></a>
## func [UpdateShareInfo](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/shareinfo.go#L67>)

```go
func UpdateShareInfo(ctx context.Context, shareInfo *ShareInfo) error
```



<a name="FileStats"></a>
## type [FileStats](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/filestats.go#L13-L26>)



```go
type FileStats struct {
    ID                       int64          `gorm:"column:id;primaryKey" json:"-"`
    RefID                    int64          `gorm:"column:ref_id;unique" json:"-"`
    Ref                      Ref            `gorm:"foreignKey:RefID;constraint:OnDelete:CASCADE"`
    NumUpdates               int64          `gorm:"column:num_of_updates" json:"num_of_updates"`
    NumBlockDownloads        int64          `gorm:"column:num_of_block_downloads" json:"num_of_block_downloads"`
    SuccessChallenges        int64          `gorm:"column:num_of_challenges" json:"num_of_challenges"`
    FailedChallenges         int64          `gorm:"column:num_of_failed_challenges" json:"num_of_failed_challenges"`
    LastChallengeResponseTxn string         `gorm:"column:last_challenge_txn;size:64" json:"last_challenge_txn"`
    WriteMarkerRedeemTxn     string         `gorm:"-" json:"write_marker_txn"`
    OnChain                  bool           `gorm:"-" json:"on_chain"`
    DeletedAt                gorm.DeletedAt `gorm:"column:deleted_at"` // soft deletion
    datastore.ModelWithTS
}
```

<a name="GetFileStats"></a>
### func [GetFileStats](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/filestats.go#L94>)

```go
func GetFileStats(ctx context.Context, ref *Ref) (*FileStats, error)
```



<a name="FileStats.BeforeCreate"></a>
### func \(\*FileStats\) [BeforeCreate](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/filestats.go#L32>)

```go
func (f *FileStats) BeforeCreate(tx *gorm.DB) error
```



<a name="FileStats.BeforeSave"></a>
### func \(\*FileStats\) [BeforeSave](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/filestats.go#L38>)

```go
func (f *FileStats) BeforeSave(tx *gorm.DB) error
```



<a name="FileStats.TableName"></a>
### func \(FileStats\) [TableName](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/filestats.go#L28>)

```go
func (FileStats) TableName() string
```



<a name="Hashnode"></a>
## type [Hashnode](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/entity.go#L4-L20>)

Hashnode ref node in hash tree

```go
type Hashnode struct {
    // hash data
    AllocationID    string `gorm:"column:allocation_id" json:"allocation_id,omitempty"`
    Type            string `gorm:"column:type" json:"type,omitempty"`
    Name            string `gorm:"column:name" json:"name,omitempty"`
    Path            string `gorm:"column:path" json:"path,omitempty"`
    ValidationRoot  string `gorm:"column:validation_root" json:"validation_root,omitempty"`
    FixedMerkleRoot string `gorm:"column:fixed_merkle_root" json:"fixed_merkle_root,omitempty"`
    ActualFileHash  string `gorm:"column:actual_file_hash" json:"actual_file_hash,omitempty"`
    ChunkSize       int64  `gorm:"column:chunk_size" json:"chunk_size,omitempty"`
    Size            int64  `gorm:"column:size" json:"size,omitempty"`
    ActualFileSize  int64  `gorm:"column:actual_file_size" json:"actual_file_size,omitempty"`

    // other data
    ParentPath string      `gorm:"parent_path" json:"-"`
    Children   []*Hashnode `gorm:"-" json:"children,omitempty"`
}
```

<a name="LoadRootHashnode"></a>
### func [LoadRootHashnode](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/hashnode.go#L12>)

```go
func LoadRootHashnode(ctx context.Context, allocationID string) (*Hashnode, error)
```

LoadRootHashnode load root node with its descendant nodes

<a name="Hashnode.AddChild"></a>
### func \(\*Hashnode\) [AddChild](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/entity.go#L27>)

```go
func (n *Hashnode) AddChild(c *Hashnode)
```



<a name="Hashnode.GetLookupHash"></a>
### func \(\*Hashnode\) [GetLookupHash](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/entity.go#L36>)

```go
func (n *Hashnode) GetLookupHash() string
```

GetLookupHash get lookuphash

<a name="Hashnode.TableName"></a>
### func \(Hashnode\) [TableName](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/entity.go#L23>)

```go
func (Hashnode) TableName() string
```

TableName get table name of Ref

<a name="ObjectPath"></a>
## type [ObjectPath](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/objectpath.go#L10-L18>)



```go
type ObjectPath struct {
    RootHash     string                 `json:"root_hash"`
    Meta         map[string]interface{} `json:"meta_data"`
    Path         map[string]interface{} `json:"path"`
    FileBlockNum int64                  `json:"file_block_num"`
    ChunkSize    int64                  `json:"chunk_size"`
    Size         int64                  `json:"size"`
    RefID        int64                  `json:"-"`
}
```

<a name="GetObjectPath"></a>
### func [GetObjectPath](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/objectpath.go#L21>)

```go
func GetObjectPath(ctx context.Context, allocationID string, blockNum int64) (*ObjectPath, error)
```

TODO needs to be refactored, current implementation can probably be heavily simplified

<a name="PaginatedRef"></a>
## type [PaginatedRef](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L117-L151>)



```go
type PaginatedRef struct {
    ID                      int64  `gorm:"column:id" json:"id,omitempty"`
    FileID                  string `gorm:"file_id" json:"file_id"`
    Type                    string `gorm:"column:type" json:"type,omitempty"`
    AllocationID            string `gorm:"column:allocation_id" json:"allocation_id,omitempty"`
    LookupHash              string `gorm:"column:lookup_hash" json:"lookup_hash,omitempty"`
    Name                    string `gorm:"column:name" json:"name,omitempty"`
    Path                    string `gorm:"column:path" json:"path,omitempty"`
    Hash                    string `gorm:"column:hash" json:"hash,omitempty"`
    NumBlocks               int64  `gorm:"column:num_of_blocks" json:"num_blocks,omitempty"`
    PathHash                string `gorm:"column:path_hash" json:"path_hash,omitempty"`
    ParentPath              string `gorm:"column:parent_path" json:"parent_path,omitempty"`
    PathLevel               int    `gorm:"column:level" json:"level,omitempty"`
    CustomMeta              string `gorm:"column:custom_meta" json:"custom_meta,omitempty"`
    ValidationRootSignature string `gorm:"column:validation_root_signature" json:"validation_root_signature,omitempty"`
    ValidationRoot          string `gorm:"column:validation_root" json:"validation_root,omitempty"`
    Size                    int64  `gorm:"column:size" json:"size,omitempty"`
    FixedMerkleRoot         string `gorm:"column:fixed_merkle_root" json:"fixed_merkle_root,omitempty"`
    ActualFileSize          int64  `gorm:"column:actual_file_size" json:"actual_file_size,omitempty"`
    ActualFileHashSignature string `gorm:"column:actual_file_hash_signature" json:"actual_file_hash_signature,omitempty"`
    ActualFileHash          string `gorm:"column:actual_file_hash" json:"actual_file_hash,omitempty"`
    MimeType                string `gorm:"column:mimetype" json:"mimetype,omitempty"`
    AllocationRoot          string `gorm:"column:allocation_root" json:"allocation_root,omitempty"`
    ThumbnailSize           int64  `gorm:"column:thumbnail_size" json:"thumbnail_size,omitempty"`
    ThumbnailHash           string `gorm:"column:thumbnail_hash" json:"thumbnail_hash,omitempty"`
    ActualThumbnailSize     int64  `gorm:"column:actual_thumbnail_size" json:"actual_thumbnail_size,omitempty"`
    ActualThumbnailHash     string `gorm:"column:actual_thumbnail_hash" json:"actual_thumbnail_hash,omitempty"`
    EncryptedKey            string `gorm:"column:encrypted_key" json:"encrypted_key,omitempty"`
    EncryptedKeyPoint       string `gorm:"column:encrypted_key_point" json:"encrypted_key_point,omitempty"`

    CreatedAt common.Timestamp `gorm:"column:created_at" json:"created_at,omitempty"`
    UpdatedAt common.Timestamp `gorm:"column:updated_at" json:"updated_at,omitempty"`

    ChunkSize int64 `gorm:"column:chunk_size" json:"chunk_size"`
}
```

<a name="GetRecentlyCreatedRefs"></a>
### func [GetRecentlyCreatedRefs](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/referencepath.go#L396-L403>)

```go
func GetRecentlyCreatedRefs(ctx context.Context, allocID string, pageLimit, offset, fromDate int) (refs []*PaginatedRef, newOffset int, err error)
```

GetRecentlyCreatedRefs will return recently created refs with pagination. As opposed to getting refs ordered by path in ascending order, this will return paths in decending order for same timestamp. So if a file is created with path "/a/b/c/d/e/f.txt" and if "/a" didn't exist previously then creation date for "/a", "/a/b", "/a/b/c", "/a/b/c/d", "/a/b/c/d/e" and "/a/b/c/d/e/f.txt" will be the same. The refs returned will be in "/a/b/c/d/e/f.txt", "/a/b/c/d/e", ... order.

pageLimit \-\-\> maximum number of refs to return fromDate \-\-\> timestamp to begin searching refs from i.e. refs created date greater than fromDate newOffset \-\-\> offset to use for subsequent request

<a name="PlaylistFile"></a>
## type [PlaylistFile](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/playlist.go#L12-L21>)



```go
type PlaylistFile struct {
    LookupHash string `gorm:"column:lookup_hash" json:"lookup_hash"`
    Name       string `gorm:"column:name" json:"name"`
    Path       string `gorm:"column:path" json:"path"`
    NumBlocks  int64  `gorm:"column:num_of_blocks" json:"num_of_blocks"`
    ParentPath string `gorm:"column:parent_path" json:"parent_path"`
    Size       int64  `gorm:"column:size;" json:"size"`
    MimeType   string `gorm:"column:mimetype" json:"mimetype"`
    Type       string `gorm:"column:type" json:"type"`
}
```

<a name="LoadPlaylist"></a>
### func [LoadPlaylist](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/playlist.go#L24>)

```go
func LoadPlaylist(ctx context.Context, allocationID, path, since string) ([]PlaylistFile, error)
```

LoadPlaylist load playlist

<a name="LoadPlaylistFile"></a>
### func [LoadPlaylistFile](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/playlist.go#L55>)

```go
func LoadPlaylistFile(ctx context.Context, allocationID, lookupHash string) (*PlaylistFile, error)
```



<a name="QueryCollector"></a>
## type [QueryCollector](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/dbCollector.go#L9-L13>)



```go
type QueryCollector interface {
    CreateRefRecord(ref *Ref)
    DeleteRefRecord(ref *Ref)
    Finalize(ctx context.Context) error
}
```

<a name="NewCollector"></a>
### func [NewCollector](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/dbCollector.go#L20>)

```go
func NewCollector(changes int) QueryCollector
```



<a name="Ref"></a>
## type [Ref](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L49-L93>)



```go
type Ref struct {
    ID                      int64  `gorm:"column:id;primaryKey"`
    FileID                  string `gorm:"column:file_id" dirlist:"file_id" filelist:"file_id"`
    Type                    string `gorm:"column:type;size:1" dirlist:"type" filelist:"type"`
    AllocationID            string `gorm:"column:allocation_id;size:64;not null;index:idx_path_alloc,priority:1;index:idx_parent_path_alloc,priority:1;index:idx_validation_alloc,priority:1" dirlist:"allocation_id" filelist:"allocation_id"`
    LookupHash              string `gorm:"column:lookup_hash;size:64;not null;index:idx_lookup_hash" dirlist:"lookup_hash" filelist:"lookup_hash"`
    Name                    string `gorm:"column:name;size:100;not null;index:idx_name_gin" dirlist:"name" filelist:"name"` // uses GIN tsvector index for full-text search
    Path                    string `gorm:"column:path;size:1000;not null;index:idx_path_alloc,priority:2;index:path_idx;index:idx_path_gin_trgm" dirlist:"path" filelist:"path"`
    FileMetaHash            string `gorm:"column:file_meta_hash;size:64;not null" dirlist:"file_meta_hash" filelist:"file_meta_hash"`
    Hash                    string `gorm:"column:hash;size:64;not null" dirlist:"hash" filelist:"hash"`
    NumBlocks               int64  `gorm:"column:num_of_blocks;not null;default:0" dirlist:"num_of_blocks" filelist:"num_of_blocks"`
    PathHash                string `gorm:"column:path_hash;size:64;not null" dirlist:"path_hash" filelist:"path_hash"`
    ParentPath              string `gorm:"column:parent_path;size:999;index:idx_parent_path_alloc,priority:2"`
    PathLevel               int    `gorm:"column:level;not null;default:0"`
    CustomMeta              string `gorm:"column:custom_meta;not null" filelist:"custom_meta"`
    ValidationRoot          string `gorm:"column:validation_root;size:64;not null;index:idx_validation_alloc,priority:2" filelist:"validation_root"`
    PrevValidationRoot      string `gorm:"column:prev_validation_root" filelist:"prev_validation_root" json:"prev_validation_root"`
    ValidationRootSignature string `gorm:"column:validation_root_signature;size:64" filelist:"validation_root_signature" json:"validation_root_signature,omitempty"`
    Size                    int64  `gorm:"column:size;not null;default:0" dirlist:"size" filelist:"size"`
    FixedMerkleRoot         string `gorm:"column:fixed_merkle_root;size:64;not null" filelist:"fixed_merkle_root"`
    ActualFileSize          int64  `gorm:"column:actual_file_size;not null;default:0" dirlist:"actual_file_size" filelist:"actual_file_size"`
    ActualFileHashSignature string `gorm:"column:actual_file_hash_signature;size:64" filelist:"actual_file_hash_signature"  json:"actual_file_hash_signature,omitempty"`
    ActualFileHash          string `gorm:"column:actual_file_hash;size:64;not null" filelist:"actual_file_hash"`
    MimeType                string `gorm:"column:mimetype;size:255;not null" filelist:"mimetype"`
    AllocationRoot          string `gorm:"column:allocation_root;size:64;not null"`
    ThumbnailSize           int64  `gorm:"column:thumbnail_size;not null;default:0" filelist:"thumbnail_size"`
    ThumbnailHash           string `gorm:"column:thumbnail_hash;size:64;not null" filelist:"thumbnail_hash"`
    PrevThumbnailHash       string `gorm:"column:prev_thumbnail_hash" filelist:"prev_thumbnail_hash"`
    ActualThumbnailSize     int64  `gorm:"column:actual_thumbnail_size;not null;default:0" filelist:"actual_thumbnail_size"`
    ActualThumbnailHash     string `gorm:"column:actual_thumbnail_hash;size:64;not null" filelist:"actual_thumbnail_hash"`
    EncryptedKey            string `gorm:"column:encrypted_key;size:64" filelist:"encrypted_key"`
    EncryptedKeyPoint       string `gorm:"column:encrypted_key_point;size:64" filelist:"encrypted_key_point"`
    Children                []*Ref `gorm:"-"`

    CreatedAt common.Timestamp `gorm:"column:created_at;index:idx_created_at,sort:desc" dirlist:"created_at" filelist:"created_at"`
    UpdatedAt common.Timestamp `gorm:"column:updated_at;index:idx_updated_at,sort:desc;" dirlist:"updated_at" filelist:"updated_at"`

    DeletedAt         gorm.DeletedAt `gorm:"column:deleted_at"` // soft deletion
    IsPrecommit       bool           `gorm:"column:is_precommit;not null;default:false" filelist:"is_precommit" dirlist:"is_precommit"`
    ChunkSize         int64          `gorm:"column:chunk_size;not null;default:65536" dirlist:"chunk_size" filelist:"chunk_size"`
    NumUpdates        int64          `gorm:"column:num_of_updates" json:"num_of_updates"`
    NumBlockDownloads int64          `gorm:"column:num_of_block_downloads" json:"num_of_block_downloads"`
    HashToBeComputed  bool           `gorm:"-"`
    // contains filtered or unexported fields
}
```

<a name="GetLimitedRefFieldsByLookupHash"></a>
### func [GetLimitedRefFieldsByLookupHash](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L247>)

```go
func GetLimitedRefFieldsByLookupHash(ctx context.Context, allocationID, lookupHash string, selectedFields []string) (*Ref, error)
```

GetLimitedRefFieldsByLookupHash get FileRef selected fields with allocationID and lookupHash from postgres

<a name="GetLimitedRefFieldsByLookupHashWith"></a>
### func [GetLimitedRefFieldsByLookupHashWith](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L231>)

```go
func GetLimitedRefFieldsByLookupHashWith(ctx context.Context, allocationID, lookupHash string, selectedFields []string) (*Ref, error)
```

GetLimitedRefFieldsByLookupHash get FileRef selected fields with allocationID and lookupHash from postgres

<a name="GetLimitedRefFieldsByPath"></a>
### func [GetLimitedRefFieldsByPath](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L219>)

```go
func GetLimitedRefFieldsByPath(ctx context.Context, allocationID, path string, selectedFields []string) (*Ref, error)
```

GetLimitedRefFieldsByPath get FileRef selected fields with allocationID and path from postgres

<a name="GetObjectTree"></a>
### func [GetObjectTree](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/referencepath.go#L202>)

```go
func GetObjectTree(ctx context.Context, allocationID, path string) (*Ref, error)
```



<a name="GetRefWithChildren"></a>
### func [GetRefWithChildren](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L345>)

```go
func GetRefWithChildren(ctx context.Context, parentRef *Ref, allocationID, path string, offset, pageLimit int) (*Ref, error)
```



<a name="GetRefWithDirListFields"></a>
### func [GetRefWithDirListFields](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L399>)

```go
func GetRefWithDirListFields(ctx context.Context, pathHash string) (*Ref, error)
```



<a name="GetRefWithSortedChildren"></a>
### func [GetRefWithSortedChildren](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L367>)

```go
func GetRefWithSortedChildren(ctx context.Context, allocationID, path string) (*Ref, error)
```



<a name="GetReference"></a>
### func [GetReference](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L208>)

```go
func GetReference(ctx context.Context, allocationID, path string) (*Ref, error)
```

GetReference get FileRef with allcationID and path from postgres

<a name="GetReferenceByLookupHash"></a>
### func [GetReferenceByLookupHash](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L258>)

```go
func GetReferenceByLookupHash(ctx context.Context, allocationID, pathHash string) (*Ref, error)
```



<a name="GetReferenceByLookupHashForDownload"></a>
### func [GetReferenceByLookupHashForDownload](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L268>)

```go
func GetReferenceByLookupHashForDownload(ctx context.Context, allocationID, pathHash string) (*Ref, error)
```



<a name="GetReferenceForHashCalculationFromPaths"></a>
### func [GetReferenceForHashCalculationFromPaths](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/referencepath.go#L27>)

```go
func GetReferenceForHashCalculationFromPaths(ctx context.Context, allocationID string, paths []string) (*Ref, error)
```

GetReferenceForHashCalculationFromPaths validate and build full dir tree from db, and CalculateHash and return root Ref without saving in DB

<a name="GetReferencePath"></a>
### func [GetReferencePath](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/referencepath.go#L22>)

```go
func GetReferencePath(ctx context.Context, allocationID, path string) (*Ref, error)
```



<a name="GetReferencePathFromPaths"></a>
### func [GetReferencePathFromPaths](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/referencepath.go#L124>)

```go
func GetReferencePathFromPaths(ctx context.Context, allocationID string, paths, objTreePath []string) (*Ref, error)
```

GetReferencePathFromPaths validate and build full dir tree from db, and CalculateHash and return root Ref

<a name="GetReferencesByName"></a>
### func [GetReferencesByName](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L286>)

```go
func GetReferencesByName(ctx context.Context, allocationID, name string) (refs []*Ref, err error)
```



<a name="GetRefsTypeFromPaths"></a>
### func [GetRefsTypeFromPaths](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L314>)

```go
func GetRefsTypeFromPaths(ctx context.Context, allocationID string, paths []string) (refs []*Ref, err error)
```

GetRefsTypeFromPaths Give list of paths it will return refs of respective path with only Type and Path selected in sql query

<a name="ListingDataToRef"></a>
### func [ListingDataToRef](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L607>)

```go
func ListingDataToRef(refMap map[string]interface{}) *Ref
```



<a name="Mkdir"></a>
### func [Mkdir](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L167>)

```go
func Mkdir(ctx context.Context, allocationID, destpath string) (*Ref, error)
```

Mkdir create dirs if they don't exits. do nothing if dir exists. last dir will be return without child

<a name="NewDirectoryRef"></a>
### func [NewDirectoryRef](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L158>)

```go
func NewDirectoryRef() *Ref
```



<a name="NewFileRef"></a>
### func [NewFileRef](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L162>)

```go
func NewFileRef() *Ref
```



<a name="Ref.AddChild"></a>
### func \(\*Ref\) [AddChild](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L509>)

```go
func (r *Ref) AddChild(child *Ref)
```



<a name="Ref.BeforeCreate"></a>
### func \(\*Ref\) [BeforeCreate](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L96>)

```go
func (ref *Ref) BeforeCreate(tx *gorm.DB) (err error)
```

BeforeCreate Hook that gets executed to update create and update date

<a name="Ref.BeforeSave"></a>
### func \(\*Ref\) [BeforeSave](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L106>)

```go
func (ref *Ref) BeforeSave(tx *gorm.DB) (err error)
```



<a name="Ref.CalculateDirHash"></a>
### func \(\*Ref\) [CalculateDirHash](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L455>)

```go
func (r *Ref) CalculateDirHash(ctx context.Context, saveToDB bool, collector QueryCollector) (h string, err error)
```



<a name="Ref.CalculateFileHash"></a>
### func \(\*Ref\) [CalculateFileHash](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L440>)

```go
func (fr *Ref) CalculateFileHash(ctx context.Context, saveToDB bool, collector QueryCollector) (string, error)
```



<a name="Ref.CalculateHash"></a>
### func \(\*Ref\) [CalculateHash](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L502>)

```go
func (r *Ref) CalculateHash(ctx context.Context, saveToDB bool, collector QueryCollector) (string, error)
```



<a name="Ref.GetFileHashData"></a>
### func \(\*Ref\) [GetFileHashData](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L419>)

```go
func (fr *Ref) GetFileHashData() string
```



<a name="Ref.GetFileMetaHashData"></a>
### func \(\*Ref\) [GetFileMetaHashData](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L412>)

```go
func (r *Ref) GetFileMetaHashData() string
```



<a name="Ref.GetHashData"></a>
### func \(\*Ref\) [GetHashData](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L436>)

```go
func (r *Ref) GetHashData() string
```



<a name="Ref.GetListingData"></a>
### func \(\*Ref\) [GetListingData](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L596>)

```go
func (r *Ref) GetListingData(ctx context.Context) map[string]interface{}
```

GetListingData reflect and convert all fields into map\[string\]interface\{\}

<a name="Ref.GetSrcPath"></a>
### func \(\*Ref\) [GetSrcPath](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/referencepath.go#L92>)

```go
func (rootRef *Ref) GetSrcPath(path string) (*Ref, error)
```



<a name="Ref.RemoveChild"></a>
### func \(\*Ref\) [RemoveChild](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L540>)

```go
func (r *Ref) RemoveChild(idx int)
```



<a name="Ref.Save"></a>
### func \(\*Ref\) [Save](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L590>)

```go
func (r *Ref) Save(ctx context.Context) error
```



<a name="Ref.SaveDirRef"></a>
### func \(\*Ref\) [SaveDirRef](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L577>)

```go
func (r *Ref) SaveDirRef(ctx context.Context, collector QueryCollector) error
```



<a name="Ref.SaveFileRef"></a>
### func \(\*Ref\) [SaveFileRef](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L563>)

```go
func (r *Ref) SaveFileRef(ctx context.Context, collector QueryCollector) error
```



<a name="Ref.TableName"></a>
### func \(Ref\) [TableName](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L113>)

```go
func (Ref) TableName() string
```



<a name="Ref.UpdatePath"></a>
### func \(\*Ref\) [UpdatePath](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/ref.go#L548>)

```go
func (r *Ref) UpdatePath(newPath, parentPath string)
```



<a name="ReferencePath"></a>
## type [ReferencePath](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/referencepath.go#L16-L20>)



```go
type ReferencePath struct {
    Meta map[string]interface{} `json:"meta_data"`
    List []*ReferencePath       `json:"list,omitempty"`
    Ref  *Ref
}
```

<a name="ShareInfo"></a>
## type [ShareInfo](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/shareinfo.go#L12-L22>)



```go
type ShareInfo struct {
    ID                        int       `gorm:"column:id;primaryKey"`
    OwnerID                   string    `gorm:"column:owner_id;size:64;not null;index:idx_marketplace_share_info_for_owner,priority:1" json:"owner_id,omitempty"`
    ClientID                  string    `gorm:"column:client_id;size:64;not null;index:idx_marketplace_share_info_for_client,priority:1" json:"client_id"`
    FilePathHash              string    `gorm:"column:file_path_hash;size:64;not null;index:idx_marketplace_share_info_for_owner,priority:2;index:idx_marketplace_share_info_for_client,priority:2" json:"file_path_hash,omitempty"`
    ReEncryptionKey           string    `gorm:"column:re_encryption_key;not null" json:"re_encryption_key,omitempty"`
    ClientEncryptionPublicKey string    `gorm:"column:client_encryption_public_key;not null" json:"client_encryption_public_key,omitempty"`
    Revoked                   bool      `gorm:"column:revoked;not null" json:"revoked"`
    ExpiryAt                  time.Time `gorm:"column:expiry_at;not null" json:"expiry_at,omitempty"`
    AvailableAt               time.Time `gorm:"column:available_at;type:timestamp without time zone;not null;default:current_timestamp" json:"available_at,omitempty"`
}
```

<a name="GetShareInfo"></a>
### func [GetShareInfo](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/shareinfo.go#L80>)

```go
func GetShareInfo(ctx context.Context, clientID, filePathHash string) (*ShareInfo, error)
```



<a name="ListShareInfoClientID"></a>
### func [ListShareInfoClientID](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/shareinfo.go#L35>)

```go
func ListShareInfoClientID(ctx context.Context, ownerID string, limit common.Pagination) ([]ShareInfo, error)
```

ListShareInfo returns list of files by a given clientID

<a name="ShareInfo.TableName"></a>
### func \(ShareInfo\) [TableName](<https://github.com/0chain/blobber/blob/staging/code/go/0chain.net/blobbercore/reference/shareinfo.go#L24>)

```go
func (ShareInfo) TableName() string
```



Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
